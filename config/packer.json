{
  "variables": {
    "repository_url": null,
    "revision": null,
    "role": null
  },
  "builders": [
  ],
  "provisioners": [
    {
      "type": "shell",
      "inline_shebang": "/bin/bash -x",
      "inline": [
        "if [ ! -d /opt/cloudconductor/patterns ]; then",
        "  sudo mkdir -p /opt/cloudconductor/patterns",
        "fi",

        "cd /opt/cloudconductor/patterns",
        "sudo git clone {{user `repository_url`}}",

        "cd /opt/cloudconductor/patterns/*",
        "sudo git checkout {{user `revision`}}",

        "if [ -f ./events/init/user-setup ]; then",
        "  sudo SERF_TAG_ROLE={{user `role`}} /opt/chefdk/embedded/bin/ruby ./events/init/user-setup",
        "fi"
      ]
    }
  ]
}
